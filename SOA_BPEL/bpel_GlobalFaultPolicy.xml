Implémentation d'une fault policy BPEL commune de rejeu automatique puis erreur :
Besoin :

Implémenter une fault policy commune à tout les composites BPEL qui rejoue les eventuels erreurs techniques pendant 7 jours puis, en cas d'echec, change le status de l'instance en erreurs.


Implémentation :


fault-bindings.xml :

 <?xml version="1.0" encoding="UTF-8"?>
<faultPolicyBindings version="2.0.2"
                     xmlns="http://schemas.oracle.com/bpel/faultpolicy"
                     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <composite faultPolicy="Faults_Policy"/>
</faultPolicyBindings>


fault-policies.xml :

 <?xml version="1.0" encoding="UTF-8"?>
<faultPolicies xmlns="http://schemas.oracle.com/bpel/faultpolicy">
    <faultPolicy version="2.0.2" id="Faults_Policy"
                 xmlns:env="http://schemas.xmlsoap.org/soap/envelope/"
                 xmlns:xs="http://www.w3.org/2001/XMLSchema"
                 xmlns="http://schemas.oracle.com/bpel/faultpolicy"
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">                 
        <Conditions>
            <faultName xmlns:bpelx="http://schemas.oracle.com/bpel/extension" name="bpelx:runtimeFault">
                <condition>
                    <action ref="ora-retry-std"/>
                </condition>
            </faultName>
            <faultName xmlns:bpelx="http://schemas.oracle.com/bpel/extension" name="bpelx:remoteFault">
                <condition>
                    <action ref="ora-retry-std"/>
                </condition>
            </faultName>
            <faultName xmlns:bpelx="http://schemas.oracle.com/bpel/extension" name="bpelx:bindingFault">
                <condition>
                    <action ref="ora-retry-std"/>
                </condition>
            </faultName>
        </Conditions>    
        <Actions>
            <Action id="ora-rethrow-fault">
                <rethrowFault/>
            </Action>
            
            <Action id="ora-retry-exp">
                <retry>
                    <retryCount>42</retryCount>
                    <retryInterval>14400</retryInterval>
                    <retryFailureAction ref="ora-rethrow-fault"/>
                </retry>
            </Action>

            <Action id="ora-retry-std">
                <retry>
                    <retryCount>72</retryCount>
                    <retryInterval>1200</retryInterval>
                    <retryFailureAction ref="ora-retry-exp"/>
                </retry>
            </Action>            
        </Actions>        
    </faultPolicy>
</faultPolicies>


COMPOSITE/composite.xml

 ...
  </service>
  <property name="productVersion" type="xs:string" many="false">11.1.1.7.0</property>
  <property name="oracle.composite.faultPolicyFile">oramds:/apps/MetaData/faultPolicies/fault-policies.xml</property>
  <property name="oracle.composite.faultBindingFile">oramds:/apps/MetaData/faultPolicies/fault-bindings.xml</property>
...

